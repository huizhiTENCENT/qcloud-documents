## 操作场景
快速创建与部署一个云函数项目。

### 前提条件

- 已安装 Serverless Framework（参考 [安装 Serverless Framework](https://cloud.tencent.com/document/product/583/44753)）
- 账号开通 Serverless 相关权限（参考 [账号和权限配置](https://cloud.tencent.com/document/product/583/44786)）


### 操作步骤

#### 创建

 使用 `sls init` 命令创建。快速创建一个 nodejs 的 SCF 示例：

```
sls init scf-demo
```

>?命令中的 `scf-demo` 可以更换成其他语言模板。目前 SCF 组件支持的模板有：go1-helloworld 、nodejs1015-helloworld、php72-helloworld、python36-helloworld。

scf-demo项目目录下会有一个serverless.yml配置文件，该文件定义了每次部署的云函数资源信息。serverless.yml配置详情介绍参考[配置文件](#配置文件)。

#### 部署

执行以下命令，将会弹出二维码，直接扫码授权进行部署：

```
sls deploy
```

>?如果鉴权失败，请参考 [权限配置](https://cloud.tencent.com/document/product/1154/43006) 进行授权。

部署成功后，会自动创建云函数资源

#### 查看

执行以下命令，查看您部署的云函数资源信息：

```
sls info
```

#### 移除

执行以下命令，移除您已经部署的函数资源：

```
sls remove
```



### 配置文件

Serverless Framework CLI创建或更新云函数，都依赖与Serverless.yml文件中的配置。

执行`sls deploy` 时，会根据 serverless.yml 文件中的配置对云函数资源进行创建或更新。一份简单的 serverlesss.yml 文件如下：

>?配置详情请参考 [全量配置文档](https://github.com/serverless-components/tencent-scf/blob/master/docs/configure.md)。

```
#scf组件配置样例
#全量配置参考https://github.com/serverless-components/tencent-scf/blob/master/docs/configure.md

#组件信息
component: scf # (必填) 引用 component 的名称，当前用到的是 tencent-scf 组件
name: scfdemo # (必填) 创建的实例名称，请修改成您的实例名称

#组件参数
inputs:
  name: ${name}-${stage}-${app} #函数名称
  src: ./  #代码路径
  handler: index.main_handler #入口
  runtime: Nodejs10.15 # 云函数运行时的环境
  region: ap-guangzhou # 云函数所在区域
  events: # 触发器
    - apigw: # 网关触发器
        parameters:
          endpoints:
            - path: /
              method: GET
```

serverless.yml 文件包含的信息：

#### 组件信息

| 组件名    | 是否必选 | 说明                                                       |
| --------- | -------- | ---------------------------------------------------------- |
| component | 必填     | component 的名称，使用`sls registry`查询您可以引入的组件。 |
| name      | 必填     | 创建的实例名称，每个组件在部署时将创建一个实例。           |


#### 参数信息

inputs 下的参数为组件配置参数。一个最简单 SCF 组件参数配置由以下几部分：

| 参数名  | 说明                                                         |
| ------- | ------------------------------------------------------------ |
| name    | 云函数名称。由于云函数又是资源 ID。                          |
| src     | 代码路径。                                                   |
| handler | 函数处理方法名称 。                                          |
| runtime | 云函数运行环境，目前支持： Python2.7、Python3.6、Nodejs6.10、Nodejs8.9、Nodejs10.15、Nodejs12.16、PHP5、PHP7、Go1、Java8 和 CustomRuntime。 |
| region  | 云函数所在的区域。                                           |
| events  | 触发器。 支持的触发器为：timer、apigw、cos、cmq、ckafka 。   |



### 操作命令

Serverless Framework框架提供了一套部署编排的操作命令，能让你快速部署函数资源。[支持命令列表](https://cloud.tencent.com/document/product/583/44785)

此外，对于`sls deploy`部署成功的云函数，云函数组件还专门提供了一些常用的操作命令。

>?命令必须在serverless.yml同目录下执行

#### 函数发版本

将函数my-function云端的$LATEST版本发布为一个固定版本：

```
sls publish-ver --inputs  function=my-function
```

#### 创建别名

给云函数my-function创建别名routing-alias，路由规则为版本1流量为50%，版本2流量为50%

```
sls create-alias --inputs name=routing-alias  function=my-function  version=1  
config='{"weights":{"2":0.5}}'
```

#### 更新别名

更新云函数my-function别名routing-alias的流量规则为版本1流量为10%，版本2流量为90%：

```
sls update-alias --inputs name=routing-alias  function=my-function  version=1 config='{"weights":{"2":0.9}}'
```

#### 列举别名

 列举云函数my-function别名routing-alias ：

```
sls list-alias --inputs function=my-function
```

#### 删除别名

删除云函数my-function的别名routing-alias：

```
sls delete-alias --inputs name=routing-alias  function=my-function
```

#### 触发函数

云端调用functionName函数，并传递json参数{"weights":{"2":0.1}}

```
sls invoke  --inputs function=functionName  clientContext='{"weights":{"2":0.1}}'
```

